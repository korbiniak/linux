# Linux drivers lab2 tasks - "Character device driver"

## Implement cdev API

### Extend the driver implemented in lab1 with character device API

Based on the materials from the last lecture extend the driver code with character device API.
Implement the following functionalities from the cdev API:

* open
* release
* read
* write
* ioctl

Implementations of the above functions should follow the API specification.
At this point they can simply print messages to Linux log.
Split the driver headers to use `uapi` functionality.

Optionally extend the driver to create `/dev` nodes automatically.
To do so, add a call to [`device_create`](https://elixir.bootlin.com/linux/v5.11/source/drivers/base/core.c#L3771) function in driver's probe.

### Implement test application

To test the driver (especially ioctls) you need to implement a simple user space application.
Remember to use [`open(2)`](https://man7.org/linux/man-pages/man2/open.2.html) (along with `read(2)`, `write(2)` and `ioctl(2)`) functions for accessing the `/dev` node files.

Cross compile your application with the toolchain generated by Buildroot, or use any other RISC-V toolchain supporting 32 bit targets.
In the latter case, remember to set correct ABI and target arch (`-march=rv32g -mabi=ilp32d`). Also, link the app statically.

Copy the app to the emulated system and test the driver.

## Dummy character device calculator

Refactor the driver to implement basic calculator functionality.
The driver should implement ioctls to provide the following functionality:

* resetting the calculation
* selecting operation
* (optional) check currently set operation

The data for calculation should be provided by writing to the `/dev` node.
Results should be obtained by reading the file.
Example flow:

```
ioctl operation_add
write <-- 2
write <-- 10
read -> 12
```

